<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <title>Exporting all Global Python Objects</title>

    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />

    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
  </head>

  <body>
  	 <label for="tagInitTime">任务的开始时间是：（What is the starting time of the task:）</label><br>
    <input type="number" id = "tagInitTime" class="numbersonly" value="3"><br>
    <label for="tagEndTime">任务的结束时间是：(What is the end time of the task:)</label><br>
    <input type="number" id = "tagEndTime" class="numbersonly" value="3"><br>
    <input type="Button" onclick="addTask()" value="添加任务(Add Task)" />
    <div>
		<table id = "tagResult"> </table>
	</div>
	<p> 讯息(Message:) <span id = "tagMessage"></span></p><br>

    
    <py-config>
      packages = ["scikit-learn","joblib"]
      [[fetch]]
      files = ['iris_model.joblib']
    </py-config>

    <py-script>
from sklearn.datasets import load_iris
from sklearn.preprocessing import StandardScaler
from sklearn.neural_network import MLPClassifier
from joblib import load

# Load the iris dataset
iris = load_iris()

# Preprocess the data
scaler = StandardScaler()
X = scaler.fit_transform(iris.data)

# Load the pre-trained model
model = load('./iris_model.joblib')

# Define a new iris sample to classify
new_sample = [[5.1, 3.5, 1.4, 0.2]]

# Preprocess the new sample
new_sample = scaler.transform(new_sample)

# Predict the class probabilities
probabilities = model.predict_proba(new_sample)[0]

# Predict the class label
predicted_class = model.predict(new_sample)[0]

# Display the results
labels = iris.target_names
predicted_label = labels[predicted_class]
print(f"The predicted class is {predicted_label}.")
print(f"The class probabilities are {probabilities}.")

    </py-script>
    <script>

    function addTask(){
      var tempStartTime = parseFloat(document.getElementById("tagInitTime").value);
			var tempFinishTime = parseFloat(document.getElementById("tagEndTime").value);

			if(isNaN(tempStartTime)){
				document.getElementById("tagMessage").innerHTML= "错误：输入的开始时间不是数字。(error:the starting time entered is not a number.)";
				return -1;
			}
			if(tempStartTime < 0){
				document.getElementById("tagMessage").innerHTML= "错误：输入的开始时间必须不为负。(error: the starting time entered needs to be no negative)";
				return -1;
			}
			if(isNaN(tempFinishTime)){
				document.getElementById("tagMessage").innerHTML= "错误：输入的结束时间不是数字。(error:the end time entered is not a number)";
				return -1;
			}
			if(tempFinishTime < 0){
				document.getElementById("tagMessage").innerHTML= "错误：输入的结束时间必须不为负。(error: the end time needs to be no negative)";
				return -1;
			}
			if(tempStartTime > tempFinishTime){
				document.getElementById("tagMessage").innerHTML= "错误：结束时间必须大于开始时间(error: the end time needs to be larger than start time)";
				return -1;
			}

            jsdomath = pyscript.interpreter.globals.get('domath');
            console.log(jsdomath(1,2));


    }
    </script>
  </body>
</html>